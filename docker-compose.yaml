services: 
  cloud: 
    build:
      context: .
      dockerfile: docker/Dockerfile.cloud
    image: cloud

# ---------- iot layer ----------
  camera1: 
    build:
      context: .
      dockerfile: docker/Dockerfile.iot
    depends_on:
      - edge
    image: iot
    environment:
      - CAMERA=video1.avi
    networks:
      - simulation_network

  camera2: 
    build:
      context: .
      dockerfile: docker/Dockerfile.iot
    depends_on:
      - edge
    image: iot
    environment:
      - CAMERA=video2.avi
    networks:
      - simulation_network

  camera3: 
    build:
      context: .
      dockerfile: docker/Dockerfile.iot
    depends_on:
      - edge
    image: iot
    environment:
      - CAMERA=video3.avi
    networks:
      - simulation_network

  camera4: 
    build:
      context: .
      dockerfile: docker/Dockerfile.iot
    depends_on:
      - edge
    image: iot
    environment:
      - CAMERA=video4.avi
    networks:
      - simulation_network
      
  alarm:
    build:
      context: .
      dockerfile: docker/Dockerfile.alarm
    depends_on:
      - edge
    image: alarm
    networks:
      - simulation_network

# ---------- edge layer ----------
  edge:
      build:
        context: .
        dockerfile: docker/Dockerfile.edge
      image: edge
      networks:
        - simulation_network
      deploy:
        resources:
          limits:
            cpus: '4'
            memory: 4G
          reservations:
            memory: 2G
      environment:
        - OMP_NUM_THREADS=1
        - MKL_NUM_THREADS=1

networks:
  simulation_network:
    driver: bridge